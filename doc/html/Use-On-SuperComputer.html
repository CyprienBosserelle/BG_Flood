<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BG_Flood: Use on SuperComputer</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="Logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">BG_Flood
   &#160;<span id="projectnumber">0.8</span>
   </div>
   <div id="projectbrief">Documentation (Work-in-progress)</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('Use-On-SuperComputer.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Use on SuperComputer </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The code can be run on local machines with NVIDIA GPU but it will get better performance by running on large GPU.</p>
<p>The code is actually running on <a href="https://www.nesi.org.nz">New Zealand eScience Infrastructure (NeSI)</a>.</p>
<h2><a class="anchor" id="autotoc_md102"></a>
Compiling the code</h2>
<p>The Code needs to be compile on the machine, using the sources grom the github repository. Due to the code dependency to CUDA and netCDF, two modules need to be loaded:</p><ul>
<li>On Maui: <div class="fragment"><div class="line">module load CUDA\11.4.1</div>
<div class="line">module load netCDF-C++4/4.3.0-GCC-7.1.0</div>
</div><!-- fragment --></li>
<li>On Mahuika: <div class="fragment"><div class="line">module load CUDA/11.4.1</div>
<div class="line">module load netCDF-C++4/4.3.1-gimpi-2020a</div>
</div><!-- fragment --></li>
</ul>
<h2><a class="anchor" id="autotoc_md103"></a>
Running the code</h2>
<ul>
<li>Example of a slurm file on Maui: <div class="fragment"><div class="line">#!/bin/bash</div>
<div class="line">#SBATCH --job-name=MY-TEST-NAME</div>
<div class="line">#SBATCH --time=8:00:00</div>
<div class="line">#SBATCH --account=MY-NESI-ACCOUNT</div>
<div class="line">#SBATCH --partition=nesi_gpu</div>
<div class="line">#SBATCH --gres=gpu</div>
<div class="line">#SBATCH --ntasks=1</div>
<div class="line">#SBATCH --cpus-per-task=2</div>
<div class="line">#SBATCH --mem=5GB</div>
<div class="line"> </div>
<div class="line">#Running directory (to be completed)</div>
<div class="line">BGFLOOD=/nesi/project/XXXXXXXXXXXXXXX</div>
<div class="line"> </div>
<div class="line">cd ${BGFLOOD}</div>
<div class="line"> </div>
<div class="line">module load CUDA/11.4.1</div>
<div class="line">module load netCDF-C++4/4.3.0-GCC-7.1.0</div>
<div class="line"> </div>
<div class="line"># Launching the executable</div>
<div class="line">srun ./BG_Flood_Maui</div>
<div class="line"> </div>
<div class="line">echo &quot;output_file = Output/${testname}/BGoutput-${reftime}.nc&quot;</div>
<div class="line"> </div>
<div class="line">echo &quot;end of setup_run_BG.sh&quot;</div>
</div><!-- fragment --></li>
<li>Example of a slurm file on Mahuika: <div class="fragment"><div class="line">#!/bin/bash</div>
<div class="line">#SBATCH --job-name=MY-TEST-NAME</div>
<div class="line">#SBATCH --time=05:00:00</div>
<div class="line">#SBATCH --account=MY-NESI-ACCOUNT</div>
<div class="line">#SBATCH --gpus-per-node=1</div>
<div class="line">#SBATCH --ntasks=1</div>
<div class="line">#SBATCH --cpus-per-task=1</div>
<div class="line">#SBATCH --mem=1GB</div>
<div class="line"> </div>
<div class="line">#Running directory (to be completed)</div>
<div class="line">BGFLOOD=/nesi/project/XXXXXXXXXXXXXXX</div>
<div class="line"> </div>
<div class="line">cd ${BGFLOOD}</div>
<div class="line"> </div>
<div class="line">#module load netCDF-C++4/4.3.0-gimkl-2017a</div>
<div class="line">module load netCDF-C++4/4.3.1-gimpi-2020a</div>
<div class="line">module load CUDA/11.4.1</div>
<div class="line"> </div>
<div class="line"># Launching the executable</div>
<div class="line">srun ./BG_Flood_Mahuika</div>
<div class="line"> </div>
<div class="line">echo &quot;output_file = Output/${testname}/BGoutput-${reftime}.nc&quot;</div>
<div class="line"> </div>
<div class="line">echo &quot;end of setup_run_BG.sh&quot;</div>
</div><!-- fragment --> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="How_to_install.html">Installation</a></li>
    <li class="footer">Generated on Tue Mar 7 2023 15:34:05 for BG_Flood by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
