<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BG_Flood: Jet tutorial with Julia</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="Logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">BG_Flood
   &#160;<span id="projectnumber">0.8</span>
   </div>
   <div id="projectbrief">Documentation (Work-in-progress)</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('TutorialJetJulia.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Jet tutorial with Julia </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This is a very simple example that shows the model stability in transitional flows.</p>
<h2><a class="anchor" id="autotoc_md10"></a>
Make a bathymetry</h2>
<p>Below is a Julia script to make the bathymetry. </p><pre class="fragment">using GMT

ny=16*16;
nx=16*32;

dx=5.0;

xmin=0;
xmax=nx*dx;

ymin=0;
ymax=ny*dx;

Bathy=zeros(nx,ny);

Bathy.=-5.0;

Bathy[170:172,:].=5.0;
Bathy[170:172,127:129].=-5.0;

Bathy[:,1:2].=5.0;
Bathy[:,(end-1):end].=5.0;

G = mat2grid(transpose(Bathy), 1,[xmin xmax ymin ymax -5.0 5.0 1 dx dx])
cmap = grd2cpt(G);      # Compute a colormap with the grid's data range
grdimage(G, lw=:thinnest, color=cmap, fmt=:png, show=true)

gmtwrite("bathy.asc", G; id="ef");
</pre><p> The result is a grid domain looking like this: <img src="https://github.com/CyprienBosserelle/BG/blob/development/Examples/Jet/bathy_jet.png" alt="Bathy file" class="inline"/> You can also use the bathy.asc file in the example folder.</p>
<h2><a class="anchor" id="autotoc_md11"></a>
Make Bnd files</h2>
<p>We are going to set the water level to 0.0m on the right and 1.0 on the left and keep it constant. To dio that we create 2 files <code>right.txt</code> and <code>left.bnd</code></p>
<h3><a class="anchor" id="autotoc_md12"></a>
&lt;tt&gt;right.bnd&lt;/tt&gt;</h3>
<pre class="fragment"># This is the right boundary
0.0 0.0
3600.0 0.0
</pre> <h3><a class="anchor" id="autotoc_md13"></a>
&lt;tt&gt;left.bnd&lt;/tt&gt;</h3>
<pre class="fragment"># This is the right boundary
0.0 1.0
3600.0 1.0
</pre> <h2><a class="anchor" id="autotoc_md14"></a>
Set up the &lt;tt&gt;BG_param.txt&lt;/tt&gt; file</h2>
<p>First it is good practice to document your parameter file: </p><pre class="fragment">##############################
## Jet demo
# CB 04/05/2019
</pre><p> Then specify the bathymetry file to use. We will use the entire domain and resolution of the file so no need for other parameter for specifying the domain. </p><pre class="fragment">bathy=bathy.asc
</pre><p> Specify the parameter theta to control the numerical diffusion of the model. but first let's leave it to the default. </p><pre class="fragment">theta=1.3;
</pre><p> This is a relatively small model so we can force the netcdf variable to be saved as floats. </p><pre class="fragment">smallnc=0
</pre><p> Sepcify the model duration, output timestep and output file name and variables </p><pre class="fragment">endtime=1800
outtimestep=10
outfile=Jet_demo.nc
outvars=zb,uu,vv,zs,vort;
</pre><p> Specify absorbing boundaries for left and right (There is a wal at the top and bottom so no need to specify any boundary there). </p><pre class="fragment">right = 3; # Absorbing bnd
rightbndfile = right.bnd

left=3; # Absorbing bnd
leftbndfile = left.txt
</pre> <h2><a class="anchor" id="autotoc_md15"></a>
Run the model</h2>
<p>If you are on windows simply double-click on the executable and in linux launch the binary.</p>
<p>Vorticity output should look like this:</p>
<p>&lt;video src="https://github.com/CyprienBosserelle/BG/blob/development/Examples/Jet/anim_01.mp4" width="320" height="200" controls preload&gt;&lt;/video&gt; <a href="https://youtu.be/f1A7EeeMlls">Video</a></p>
<h2><a class="anchor" id="autotoc_md16"></a>
Things to try</h2>
<ul>
<li>What happens when using a different value for theta (1-2.0)</li>
<li>What happens when specifying a different type of boundary on the right</li>
<li>What happens when you bring the boundary close to the jet</li>
<li>Why is the jet so unstable/asymmetrical? (what are the initial condition like?)</li>
</ul>
<h1><a class="anchor" id="autotoc_md17"></a>
Gaussian Wave</h1>
<p>This is a great example to test whether there are bugs in the model and how the boundary work.</p>
<h2><a class="anchor" id="autotoc_md18"></a>
Bathymetry</h2>
<p>We start with a flat bathymetry with 0.0 everywhere. You still need a file for that!</p>
<p>Here a couple of suggestion on making the file: Using GMT: <code>grdmath -R-5/5/-5/5 -I0.03921 0 MUL = bathy.nc</code></p>
<p>Using Julia: See section below with the hotstart file.</p>
<p>In any case you can pick up the file in the example folder.</p>
<h2><a class="anchor" id="autotoc_md19"></a>
Hortstart</h2>
<p>We want to setup a bump in the water level centered in the middle of the bathy. IN the example below this is done using Julia, but it should be easily done in Matlab or Python. Note that the script below also generates a bathymetry file.</p>
<pre class="fragment">using GMT

xo=-5;
yo=-5;

nx=16*16;
ny=16*16;

len=10.0;

dx=len/(nx-1);

xx=collect(xo:len/(nx-1):(len+xo));
yy=collect(yo:len/(ny-1):(len+yo));

# Make a bathy file
zb=zeros(nx,ny);
G = mat2grid(transpose(zb), 1,[xx[1] xx[end] yy[1] yy[end] minimum(zb) maximum(zb) 1 dx dx])
gmtwrite("bathy.asc", G; id="ef");

#make the hotstart file
hh=zeros(nx,ny);
for i=1:nx
    for j=1:ny
        hh[i,j] = 1.0.+ 1.0.*exp.(-1.0*(xx[i].*xx[i] .+ yy[j].*yy[j]));
        #hh[i,j] =
    end
end

G = mat2grid(transpose(hh), 1,[xx[1] xx[end] yy[1] yy[end] minimum(hh) maximum(hh) 1 dx dx])
cmap = grd2cpt(G);      # Compute a colormap with the grid's data range
grdimage(G, lw=:thinnest, color=cmap, fmt=:png, show=true)

gmtwrite("gauss.asc", G; id="ef");
gmtwrite("gauss.nc", G);
# GMT netcdf variable is "z" by default but the hotstart file needs "zs" for water surface
gmt("grdmath gauss.nc 1.0 MUL = gauss_zs.nc?zs");
</pre> <h2><a class="anchor" id="autotoc_md20"></a>
Make Bnd files</h2>
<p>We are going to set the water level to 0.0m on all 4 sides and keep it constant. To do that we create 1 files <code>zero.txt</code>: </p><pre class="fragment"># This is the a boundary
0.0 0.0
3600.0 0.0
</pre> <h2><a class="anchor" id="autotoc_md21"></a>
Set up the &lt;tt&gt;BG_param.txt&lt;/tt&gt; file</h2>
<p>First it is good practice to document your parameter file: </p><pre class="fragment">##############################
## Gaussian bump demo
# CB 04/05/2019
</pre><p> Then specify the bathymetry file to use. We will use the entire domain and resolution of the file so no need for other parameter for specifying the domain. </p><pre class="fragment">bathy=bathy.asc
</pre><p> This is a relatively small model so we can force the netcdf variable to be saved as floats. </p><pre class="fragment">smallnc=0
</pre><p> Specify the hotstart file: </p><pre class="fragment">hotstartfile=gauss_zs.nc;
</pre><p> Boundary conditions are all the same : </p><pre class="fragment">right = 3; # Absorbing bnd
rightbndfile = zeros.txt

top = 3; # Absorbing bnd
topbndfile = zeros.txt

bot = 3; # Absorbing bnd
botbndfile = zeros.txt

left=3; # Absorbing bnd
leftbndfile=zeros.txt
</pre><p> Time keeping: </p><pre class="fragment">endtime=20;
outtimestep=1;
</pre><p> Output parameters: </p><pre class="fragment"># Netcdf file for snapshot of the model domain
outfile=Gauss_demo.nc
outvars=zb,uu,vv,zs,vort;

# Outpout a single txt file with all the model steps at the nearest node to location x=0.0, y=-4.0
# This file will contain 5 column: time,zs,hh,uu,vv
TSOfile=Southside.txt;
TSnode=0.0,-4.0;
</pre> <h2><a class="anchor" id="autotoc_md22"></a>
Run the model</h2>
<p>Plot Southside.txt in your favorite tool.</p>
<h2><a class="anchor" id="autotoc_md23"></a>
Things to try:</h2>
<ul>
<li>What happens with different boundary types</li>
<li>Try running with double precision. What is the difference?</li>
</ul>
<h1><a class="anchor" id="autotoc_md24"></a>
Transpacific tsunami</h1>
<p>This tutorial is the next stat from the Gaussian wave. Here we produce a realistic tsunami and let it propagate across the Pacific.</p>
<h2><a class="anchor" id="autotoc_md25"></a>
Bathy and domain definition</h2>
<p>The bathymetry file we are using was extracted from the GEBCO gobal bathymetry using GMT command grdcut / grdsample. This section needs a tutorial of its own. Here in the <code>BG_param.txt</code> we specify the file name and that it is a spherical model domain. </p><pre class="fragment"># Bathymetry file
bathy = Tpac_big.asc;
spherical = 1;
</pre><p> The file covers a bigger area than we want to use for the simulation so we restict the domain: </p><pre class="fragment">ymin=-78.0
ymax=14.32

dx=0.08;
</pre><p> Also we do not want to simulate Blocks that are entirely covered in land where the elevation is bigger than say 30.0m above the datum </p><pre class="fragment">mask = 30.0;
</pre><h2><a class="anchor" id="autotoc_md26"></a>
Initial tsunami wave</h2>
<p>See matlab file in the folder or simply use: </p><pre class="fragment">hotstartfile=Maule_zs_init_simpleflt.nc;
</pre> <h2><a class="anchor" id="autotoc_md27"></a>
Boundary</h2>
<p>In the previous tutorial you have seen how different boundary type let's wave through with minimal reflection. You choose.</p>
<h2><a class="anchor" id="autotoc_md28"></a>
Time Keeping</h2>
<pre class="fragment">totaltime = 0.000000; # Start time
endtime = 54000.000000;
outputtimestep = 600.000000;
</pre> <h2><a class="anchor" id="autotoc_md29"></a>
Outputs</h2>
<pre class="fragment">outvars = hh,zs,zsmax;
# Files
outfile = Output_simple_fault.nc;
smallnc = 0; #if smallnc==1 all Output are scaled and saved as a short int

TSnode = -86.374,-17.984
TSOfile = SW_Lima.txt
</pre> <h2><a class="anchor" id="autotoc_md30"></a>
Things to try</h2>
<ul>
<li>Try changing the model domain and resolution. What happens if part of the domain is outside of the area covered by the bathymetry?</li>
<li>Try outputing a time series near Christchurch</li>
</ul>
<h1><a class="anchor" id="autotoc_md31"></a>
River + Rain = Waikanae example</h1>
<p>Here we setup a model of the Waikanae Catchment (on the Kapiti Coast in New Zealand) force the tide on one of the open boundary </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="Tutorials.html">Tutorials</a></li>
    <li class="footer">Generated on Tue Mar 7 2023 15:15:50 for BG_Flood by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
